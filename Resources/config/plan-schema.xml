<?xml version="1.0" encoding="UTF-8"?>
<database name="default" namespace="Dzangocart\Bundle\SubscriptionBundle\Propel" defaultIdMethod="native">
	<table name="plan">
		<column name="id"          type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="name"        type="varchar" size="100" required="true" primaryString="true" />
		<column name="description" type="longvarchar" required="true" />
		<column name="start"       type="timestamp" required="false" />
		<column name="finish"      type="timestamp" required="false" />
		<column name="is_default"  type="boolean" required="true" default="false" />
		<column name="disabled"    type="boolean" required="true" default="false" />
		<behavior name="i18n">
			<parameter name="i18n_columns" value="name, description"/>
		</behavior>
		<behavior name="sortable">
			<parameter name="rank_column" value="rank"/>
		</behavior>
	</table>

	<table name="plan_price">
		<column name="id"         type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="plan_id"    type="integer" required="true" />
		<column name="currency"   type="varchar" size="3" required="true" default="EUR" />
		<column name="price"      type="float" size="10" scale="4" required="true" />
		<column name="period_id"  type="integer" required="false" />
		<column name="start"      type="timestamp" required="false" />
		<column name="finish"     type="timestamp" required="false" />
		<column name="is_default" type="boolean" required="true" default="false" />
		<foreign-key foreignTable="plan" refPhpName="Price" onDelete="cascade">
			<reference local="plan_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="plan_period" phpName="Period">
			<reference local="period_id" foreign="id" />
		</foreign-key>
		<behavior name="sortable">
			<parameter name="rank_column" value="rank"/>
		</behavior>
	</table>

	<table name="plan_feature_definition">
		<column name="id"          type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="name"        type="varchar" size="100" required="true" primaryString="true" />
		<column name="description" type="longvarchar" required="false" />
		<behavior name="i18n">
			<parameter name="i18n_columns" value="name, description"/>
		</behavior>
		<behavior name="sortable">
			<parameter name="rank_column" value="rank"/>
		</behavior>
	</table>

	<table name="plan_feature">
		<column name="id"            type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="plan_id"       type="integer" required="true" />
		<column name="definition_id" type="integer" required="true" />
		<column name="value"         type="varchar" size="255" required="true" />
		<column name="period_id"     type="integer" required="false" />
		<column name="unit_id"       type="integer" required="false" />
		<foreign-key foreignTable="plan" name="FI_plan_feature_plan" onDelete="cascade">
			<reference local="plan_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="plan_feature_definition" name="FI_plan_feature_definition" phpName="Definition" onDelete="restrict">
			<reference local="definition_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="plan_period" name="FI_plan_feature_period" phpName="Period" onDelete="restrict">
			<reference local="period_id" foreign="id" />
		</foreign-key>
		<foreign-key foreignTable="plan_unit" name="FI_plan_feature_unit" phpName="Unit" onDelete="restrict">
			<reference local="unit_id" foreign="id" />
		</foreign-key>
		<index>
			<index-column name="definition_id" />
		</index>
		<index>
			<index-column name="plan_id" />
		</index>
		<unique name="plan">
			<unique-column name="plan_id" />
			<unique-column name="definition_id" />
		</unique>
	</table>

	<table name="plan_period" allowPkInsert="true">
		<column name="id"            type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="date_interval" type="varchar" size="10" required="true" />
		<column name="name"          type="varchar" size="20" required="true" primaryString="true" />
		<column name="plural"        type="varchar" size="20" required="true" />
		<behavior name="i18n">
			<parameter name="i18n_columns" value="name, plural"/>
		</behavior>
	</table>

	<table name="plan_unit" allowPkInsert="true">
		<column name="id"     type="integer" required="true" primaryKey="true" autoIncrement="true" />
		<column name="name"   type="varchar" size="20" required="true" primaryString="true" />
		<column name="plural" type="varchar" size="20" required="true" />
		<behavior name="i18n">
			<parameter name="i18n_columns" value="name, plural"/>
		</behavior>
	</table>

</database>
